<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>发帖</title>
    <link rel="shortcut icon" type="image/x-icon" href="../img/tuji.ico">
    <link type="text/css" rel="stylesheet" href="../css/common.css"/>
    <link type="text/css" rel="stylesheet" href="../css/postMessage.css"/>
<script>"undefined"==typeof CODE_LIVE&&(!function(e){var t={nonSecure:"57474",secure:"57483"},c={nonSecure:"http://",secure:"https://"},r={nonSecure:"127.0.0.1",secure:"gapdebug.local.genuitec.com"},n="https:"===window.location.protocol?"secure":"nonSecure";script=e.createElement("script"),script.type="text/javascript",script.async=!0,script.src=c[n]+r[n]+":"+t[n]+"/codelive-assets/bundle.js",e.getElementsByTagName("head")[0].appendChild(script)}(document),CODE_LIVE=!0);</script><script>"undefined"==typeof CODE_LIVE&&(!function(e){var t={nonSecure:"57474",secure:"57483"},c={nonSecure:"http://",secure:"https://"},r={nonSecure:"127.0.0.1",secure:"gapdebug.local.genuitec.com"},n="https:"===window.location.protocol?"secure":"nonSecure";script=e.createElement("script"),script.type="text/javascript",script.async=!0,script.src=c[n]+r[n]+":"+t[n]+"/codelive-assets/bundle.js",e.getElementsByTagName("head")[0].appendChild(script)}(document),CODE_LIVE=!0);</script></head>
<body data-genuitec-lp-enabled="false" data-genuitec-file-id="wc1-51" data-genuitec-path="/tuji1.0.1/src/main/webapp/html/postMessage.html" data-genuitec-lp-enabled="false" data-genuitec-file-id="wc1-51" data-genuitec-path="/tuji1.0.2/src/main/webapp/html/postMessage.html">
<!--top-->
<div id="top" data-genuitec-lp-enabled="false" data-genuitec-file-id="wc1-51" data-genuitec-path="/tuji1.0.1/src/main/webapp/html/postMessage.html" data-genuitec-lp-enabled="false" data-genuitec-file-id="wc1-51" data-genuitec-path="/tuji1.0.2/src/main/webapp/html/postMessage.html">
    <h1 id="logo">
        <a href="index.html">
            <img src="../img/logo.png"/>
        </a>
    </h1>
    <ul>
        <li><a href="index.html">首页</a></li>
        <li><a href="state.html">品途</a></li>
        <li><a href="share.html">思途</a></li>
        <li><a href="trip.html">旅途</a></li>
    </ul>
    <p>
        <input type="text" id="search"/>
        <a href="#" id="gosearch">
            <img src="../img/icon/search.png"/>
        </a>
    </p>
    <p class="logRes">
        <a href="login.html">登录</a>
        <a href="login.html">注册</a>
    </p>

    <div id="afterLogin">
        <img id="idPic" src=""/>
        <a id="idName" href="#">abcdefghijklmn</a>
        <ul>
            <li><a href="" id="selfindi">个人主页</a></li>
            <li><a href="personal_setting.html">个人设置</a></li>
            <li><a href="#">退出</a></li>
        </ul>
    </div>
</div>



<!--editor-->
<div class="postMess">
    <p>我要发帖</p>
    <input type="text" id="articalTitle" placeholder="在此键入标题" autofocus="autofocus"/>
    <p class="artTip">
        <input type="text" id="articalTip" placeholder="添加相关标签，用空格分离（前三个有效）" />
    </p>
    <div id="hotTip">
        <span>热门标签：</span>
        <strong>途记</strong>
        <strong>旅游</strong>
        <strong>love</strong>
        <strong>在路上</strong>
        <strong>郑州</strong>
        <strong>宁波</strong>
    </div>
    <div id="editor" style="height:auto;">
        <!-- <p class="ph" style="color:#aaa;">请输入您要发布的内容</p> -->
    </div>
    <button id="postMess">发布</button>
</div>


<!--footer-->
<div id="footer-wrap">
    <div>
        <div>
            <ul>
                <p>关于我们</p>
                <p>ABOUT US</p>
                <li><a href="#">关于途记</a></li>
                <li><a href="#">加入我们</a></li>
                <li><a href="#">联系我们</a></li>
                <li><a href="#">媒体报道</a></li>
                <li><a href="#">商业合作</a></li>
                <li><a href="#">Cooperation</a></li>
            </ul>
            <ul>
                <p>帮助中心</p>
                <p>HELP</p>
                <li><a href="#">玩转途记</a></li>
                <li><a href="#">建议反馈</a></li>
                <li><a href="#">申请认证</a></li>
            </ul>
            <ul>
                <p>关于体验</p>
                <p>EXPERIENCE</p>
                <li><a href="#">为何免费</a></li>
                <li><a href="#">是否有黑幕</a></li>
                <li><a href="#">何为体验官</a></li>
                <li><a href="#">体验官如何产生</a></li>
                <li><a href="#">活动视频</a></li>
            </ul>
            <ul>
                <p>网站条款</p>
                <p>SITE TERMS</p>
                <li><a href="#">会员条款</a></li>
                <li><a href="#">版权声明</a></li>
            </ul>
        </div>
        <p>copyright 2014 daizhe.cn All rights reserved <a href="#">京ICP备10215719号-5</a></p>
    </div>
</div>
</body>


<script type="text/javascript" src="../js/lib/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../js/app/postMessage/wangEditor.min.js"></script>
<script src="../js/app/top.js"></script>
<script type="text/javascript">

    $("#editor").keydown(function(){
        $(".ph").css("display","none");
    })

    // input框输入标签
    var arr=[];
    $("#articalTip").keydown(function(e){
        var e = e||event;
//        && $("#articalTip").val().match(/^.*[]$/)
        if(!($("#articalTip").val().match(/^[ ]+$/)) && e.keyCode == 32){
            var $i = $("<strong>").addClass("tip");
            $i.html($("#articalTip").val());
            arr.push($("#articalTip").val());
            $("#articalTip").before($i);
            $("#articalTip").val("").attr("placeholder"," ");
        }
        if(!$("#articalTip").val() && e.keyCode == 8){
            $(".artTip").find("strong").last().remove();
        }
    })

    // 热门标签获取标签
    var limit = $("#hotTip").find("strong").length;
    for(var i=0; i<limit; i++){
        $("#hotTip").find("strong").eq(i).on("click",function(){
            var val = $(this).html();
            arr.push(val);
            var ele = arr[arr.length-1];
            var $hotTip = $("<strong>"+ele+"</strong>").addClass("tip")
            $("#articalTip").before($hotTip);
        })
    }

    // 富文本框
    var E = window.wangEditor;
    var editor = new E('#editor');

    //插入链接的校验
    editor.customConfig.linkCheck = function (text, link) {
        console.log(text) // 插入的文字
        console.log(link) // 插入的链接
        return true // 返回 true 表示校验成功
        // return '验证失败' // 返回字符串，即校验失败的提示信息
    }

    /*上传图片*/
    editor.customConfig.uploadImgShowBase64 = true;// 使用 base64 保存图片
    editor.customConfig.showLinkImg = false;
    /*// 上传图片到服务器
    editor.customConfig.uploadImgServer = '/upload';
    // 图片大小限制为 3M
    editor.customConfig.uploadImgMaxSize = 3 * 1024 * 1024;
    // 限制一次最多上传 10 张照片
    editor.customConfig.uploadImgMaxLength = 10;*/

    editor.create();

    document.getElementById('postMess').addEventListener('click', function () {

        console.log(111);
        console.log(editor.txt.html());
        // 标签只取前三个有效
        if(arr.length <= 3){
            tip = arr;
        }else{
            for(var i=0; i<3; i++){
                tip.push(arr[i]);
            }
        }
        console.log(tip);

        // 标题，标签，内容都非空时上传帖子
        if($("#articalTitle").val() && $("#articalTip").val() && editor.txt.html()){
            console.log(tip);
            $(function(){
                $.ajax({
                    type:"post",
                    url:"",                              //上传地址
                    data:{
                        title:$("#articalTitle").val(),  //文章标题
                        tip:tip,                         //文章标签
                        articalCon:editor.txt.html()     //文章内容
                    },
                    success:function(data){
                        console.log("上传成功");
                    },
                    error:function(){
                        console.log("error");
                    }
                })
            })
        }
    }, false)

</script>
</html>